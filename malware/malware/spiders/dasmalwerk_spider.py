import scrapy
from scrapy.selector import Selector
import re
import subprocess
from malware.items import FileDownloadItem


FILE_STORE='G:/dasmalwerk/'


class DasMalwerkSpider(scrapy.Spider):
    name = "dasmalwerk"
    allowed_domains = ["dasmalwerk.eu"]
    start_urls = ["http://dasmalwerk.eu/"]
    res = []

    def parse(self, response):
        # print(response.body)
        sel = Selector(text=response.body,type="html")
        links = sel.xpath("//a/@href").re('http://.*\.zip')

        for link in links:
            print(link)
            p = subprocess.Popen(["wget", link, "-P", FILE_STORE],shell=True)
            p.wait()

